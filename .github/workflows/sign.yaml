name: sign

on:
  push:
    branches: ['reviewed']
  workflow_dispatch:

jobs:
  sign:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: upload-unsigned-artifact
      id: upload-unsigned-artifact
      uses: actions/upload-artifact@v4
      with:
        name: OfficeFiles
        path: OfficeFiles/*
        if-no-files-found: error

    - name: Sign
      uses: signpath/github-action-submit-signing-request@v1
      with:
        api-token: '${{ secrets.SIGNPATH_API_TOKEN }}'
        organization-id: '${{ vars.SIGNPATH_ORGANIZATION_ID }}'
        project-slug: '${{ vars.SIGNPATH_PROJECT_SLUG }}'
        signing-policy-slug: 'release-signing'
        github-artifact-id:  "${{steps.upload-unsigned-artifact.outputs.artifact-id}}"
        wait-for-completion: true
        output-artifact-directory: 'OfficeFiles.Signed'

    - name: upload-signed-artifact
      uses: actions/upload-artifact@v4
      with:
        name: OfficeFiles.Signed
        path: OfficeFiles.Signed/*
        if-no-files-found: error
